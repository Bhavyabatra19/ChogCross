<!DOCTYPE html>
<html>
  <head>
    <title>Chog Cross Gambling</title>
    <link rel="icon" href="sprites/favicon.ico" type="image/x-icon" />
    <meta
      http-equiv="Cache-Control"
      content="no-cache, no-store, must-revalidate"
    />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <link rel="stylesheet" href="css/reset.css" type="text/css" />
    <link rel="stylesheet" href="css/main.css" type="text/css" />
    <link rel="stylesheet" href="css/orientation_utils.css" type="text/css" />
    <link rel="stylesheet" href="css/privy-wallet.css" type="text/css" />
    <!-- Google Fonts - Orbitron -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap"
      rel="stylesheet"
    />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="theme-color" content="#000000" />

    <!-- External Wallet Blocker (disabled to allow injected wallets like Rabby) -->
    <script type="text/javascript">
      console.log(
        "ℹ️ External wallet blocker disabled: allowing injected wallets (MetaMask, Rabby, etc.)"
      );
    </script>

    <script type="text/javascript" src="js/jquery-3.1.1.min.js"></script>
    <script type="text/javascript" src="js/createjs-2015.11.26.min.js"></script>
    <script type="text/javascript" src="js/howler.min.js"></script>
    <script type="text/javascript" src="js/screenfull.js"></script>
    <script type="text/javascript" src="js/ctl_utils.js"></script>
    <script type="text/javascript" src="js/sprite_lib.js"></script>
    <script type="text/javascript" src="js/settings.js"></script>
    <script type="text/javascript" src="js/GraphicsEngine.js"></script>
    <script type="text/javascript" src="js/TextRenderer.js"></script>
    <script type="text/javascript" src="js/SidePanels.js"></script>
    <script type="text/javascript" src="js/GameFrameManager.js"></script>
    <script type="text/javascript" src="js/AutoModeManager.js"></script>
    <script type="text/javascript" src="js/GameConfig.js"></script>
    <script type="text/javascript" src="js/GameManager.js"></script>
    <script type="text/javascript" src="js/ModernUtils.js"></script>
    <script type="text/javascript" src="js/CGameES6.js"></script>
    <script type="text/javascript" src="js/WarningSuppressor.js"></script>
    <script type="text/javascript" src="js/ErrorLogger.js"></script>
    <script type="text/javascript" src="js/CLang.js"></script>
    <script type="text/javascript" src="js/CPreloader.js"></script>
    <script type="text/javascript" src="js/CMain.js"></script>
    <script type="text/javascript" src="js/CTextButton.js"></script>
    <script type="text/javascript" src="js/CToggle.js"></script>
    <script type="text/javascript" src="js/CGfxButton.js"></script>
    <script type="text/javascript" src="js/CMenu.js"></script>
    <script type="text/javascript" src="js/CCharacter.js"></script>
    <script type="text/javascript" src="js/CGame.js"></script>
    <script type="text/javascript" src="js/CInterface.js"></script>
    <script type="text/javascript" src="js/CSeaAnimation.js"></script>
    <script type="text/javascript" src="js/CRiverAnimation.js"></script>
    <script type="text/javascript" src="js/CSharkAnimation.js"></script>
    <script type="text/javascript" src="js/CSharkAttackAnimation.js"></script>
    <script type="text/javascript" src="js/CObstacle.js"></script>
    <script type="text/javascript" src="js/CHowToPanel.js"></script>
    <script type="text/javascript" src="js/CCreditsPanel.js"></script>
    <script type="text/javascript" src="js/CEndPanel.js"></script>
    <script type="text/javascript" src="js/CHelpPanel.js"></script>
    <script type="text/javascript" src="js/CMsgBox.js"></script>

    <!-- Social Features Scripts -->
    <script type="text/javascript" src="js/SocialFeatures.js"></script>
    <script type="text/javascript" src="js/OnlinePlayerIndicator.js"></script>
    <!-- <script type="text/javascript" src="js/GlobalLeaderboard.js"></script> -->

    <!-- JSON Database Scripts -->
    <!-- JSON Database Scripts -->
    <!-- <script type="text/javascript" src="js/JSONLeaderboard.js"></script> -->
    <!-- <script type="text/javascript" src="js/CLeaderboard.js"></script> -->

    <!-- viem UMD MUST be loaded before wallet/game scripts for 2048 approach -->
    <script src="https://unpkg.com/viem@2.26.0/dist/viem.umd.js"></script>
    <script>
      try {
        if (window.viem) {
          window.viemCreateWalletClient = window.viem.createWalletClient;
          window.viemCustomTransport = window.viem.custom;
          console.log(
            "✅ viem UMD loaded and globals exposed for WalletManager"
          );
        } else {
          console.warn("⚠️ viem UMD not available");
        }
      } catch (e) {
        console.warn(
          "⚠️ viem bootstrap failed:",
          e && e.message ? e.message : e
        );
      }
    </script>
    <!-- Toast utility -->
    <script type="text/javascript" src="js/Toast.js"></script>
    <!-- Tx progress utility -->
    <script type="text/javascript" src="js/TxProgress.js"></script>

    <!-- Ethers.js CDN for Contract Interaction -->
    <script
      src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"
      type="text/javascript"
    ></script>

    <!-- Contract ABI and Configuration -->
    <script type="text/javascript" src="js/ChogCrossABI.js"></script>

    <!-- Wallet Integration Scripts -->
    <!-- viem module shim no longer needed since UMD is loaded earlier -->

    <script type="text/javascript" src="js/WalletManager.js"></script>
    <!-- React Privy Wallet Bundle -->
    <script type="text/javascript" src="dist/wallet.bundle.js"></script>

    <!-- Initialize Social Features -->
    <script type="text/javascript">
      // Initialize Social Features when page loads
      window.addEventListener("load", function () {
        try {
          // Initialize Social Features
          if (window.socialFeatures) {
            window.socialFeatures.init();
            console.log("🌟 Social Features system ready!");
          }

          // Initialize JSON Leaderboard
          if (window.jsonLeaderboard) {
            window.jsonLeaderboard.init();
            console.log("📊 JSON Leaderboard system ready!");
          }

          // Initialize Wallet Manager
          if (window.walletManager) {
            console.log("🔗 Wallet Manager system ready!");
          }

          // Online Player Indicator will be initialized by CMenu
          console.log(
            "👥 Online Player Indicator will be initialized by menu system!"
          );
        } catch (error) {
          console.error("❌ Social Features initialization error:", error);
        }
      });
    </script>
  </head>
  <body ondragstart="return false;" ondrop="return false;">
    <!-- Privy Modal Overlay -->

    <!-- VRF Loading Overlay -->
    <div id="vrf-loading-overlay" style="display: none">
      <div class="vrf-loading-text">Loading...</div>
    </div>

    <!-- viem UMD for popup-free signTransaction like 2048 -->
    <script src="https://unpkg.com/viem@2.26.0/dist/viem.umd.js"></script>
    <script>
      try {
        if (window.viem) {
          window.viemCreateWalletClient = window.viem.createWalletClient;
          window.viemCustomTransport = window.viem.custom;
          console.log(
            "✅ viem UMD loaded and globals exposed for WalletManager"
          );
        } else {
          console.warn("⚠️ viem UMD not available");
        }
      } catch (e) {
        console.warn(
          "⚠️ viem bootstrap failed:",
          e && e.message ? e.message : e
        );
      }
    </script>

    <div
      style="
        position: fixed;
        background-color: transparent;
        top: 0px;
        left: 0px;
        width: 100%;
        height: 100%;
        pointer-events: none; /* allow clicks to pass through to the page (was blocking injected wallets) */
      "
    ></div>
    <script>
      $(document).ready(function () {
        var oMain = new CMain({
          fullscreen: true, //SET THIS TO FALSE IF YOU DON'T WANT TO SHOW FULLSCREEN BUTTON
          check_orientation: true, //SET TO FALSE IF YOU DON'T WANT TO SHOW ORIENTATION ALERT ON MOBILE DEVICES
        });

        $(oMain).on("start_session", function (evt) {
          if (getParamValue("ctl-arcade") === "true") {
            parent.__ctlArcadeStartSession();
          }
        });

        $(oMain).on("end_session", function (evt) {
          if (getParamValue("ctl-arcade") === "true") {
            parent.__ctlArcadeEndSession();
          }
        });

        $(oMain).on("restart_level", function (evt, iLevel) {
          if (getParamValue("ctl-arcade") === "true") {
            parent.__ctlArcadeRestartLevel({ level: iLevel });
          }
        });

        $(oMain).on("save_score", function (evt, iScore) {
          if (getParamValue("ctl-arcade") === "true") {
            parent.__ctlArcadeSaveScore({ score: iScore });
          }
        });

        $(oMain).on("show_interlevel_ad", function (evt) {
          if (getParamValue("ctl-arcade") === "true") {
            parent.__ctlArcadeShowInterlevelAD();
          }
        });

        $(oMain).on("share_event", function (evt, iScore) {
          if (getParamValue("ctl-arcade") === "true") {
            parent.__ctlArcadeShareEvent({
              img: TEXT_SHARE_IMAGE,
              title: TEXT_SHARE_TITLE,
              msg: TEXT_SHARE_MSG1 + iScore + TEXT_SHARE_MSG2,
              msg_share: TEXT_SHARE_SHARE1 + iScore + TEXT_SHARE_SHARE1,
            });
          }
        });

        if (isIOS()) {
          setTimeout(function () {
            sizeHandler();
          }, 200);
        } else {
          sizeHandler();
        }
      });
    </script>

    <div class="check-fonts">
      <p class="check-font-1">test 1</p>
    </div>

    <!-- Privy Wallet Root - Moved to left panel -->
    <div id="privy-wallet-root" style="display: none"></div>

    <!-- Game Canvas Area -->
    <div id="game-container">
      <!-- Main Game Frame Container -->
      <div id="game-frame-container" class="game-frame">
        <!-- Middle Row - Left Panel, Game Canvas, Right Panel -->
        <div id="middle-row" class="middle-row">
          <!-- Left Panel - Wallet UI -->
          <div id="left-panel" class="frame-panel left-panel">
            <div class="panel-content">
              <!-- Wallet UI will be rendered here -->
              <div id="privy-wallet-root-left" class="wallet-container-left">
                <!-- Wallet will be rendered here -->
                <!-- Fallback Connect/Open Wallet button for non-React consumers -->
                <div style="margin-top: 12px">
                  <button
                    id="connect-wallet-game-btn"
                    style="
                      background: #676fff;
                      color: #fff;
                      border: none;
                      border-radius: 8px;
                      padding: 10px 14px;
                      font-weight: bold;
                      cursor: pointer;
                      font-size: 15px;
                    "
                  >
                    Connect Wallet
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Center Panel - Game Canvas -->
          <div id="center-panel" class="frame-panel center-panel">
            <div class="panel-content">
              <canvas
                id="canvas"
                class="ani_hack"
                width="1200"
                height="800"
                style="display: block"
              ></canvas>
            </div>
          </div>

          <!-- Right Panel - Game Menu -->
          <div id="right-panel" class="frame-panel right-panel">
            <div class="panel-content">
              <!-- SVG Menu System - Moved to Right Panel -->
              <div class="svg-menu-container" id="svg-menu-container-right">
                <div class="menu-items" id="menu-items-right">
                  <div
                    class="menu-item"
                    id="menu-leaderboard-right"
                    data-tooltip="Leaderboard"
                  >
                    <img
                      class="menu-item-icon"
                      src="sprites/but_leaderboard.png"
                      alt="Leaderboard"
                      width="82"
                      height="82"
                    />
                  </div>
                  <div
                    class="menu-item"
                    id="menu-options-right"
                    data-tooltip="Options"
                  >
                    <img
                      class="menu-item-icon"
                      src="sprites/but_opts.png"
                      alt="Options"
                      width="82"
                      height="82"
                    />
                  </div>
                  <div
                    class="menu-item"
                    id="menu-sound-right"
                    data-tooltip="Sound"
                  >
                    <img
                      class="menu-item-icon"
                      src="sprites/but_audio.png"
                      alt="Sound"
                      width="82"
                      height="82"
                    />
                  </div>
                  <div
                    class="menu-item"
                    id="menu-fullscreen-right"
                    data-tooltip="Fullscreen"
                  >
                    <img
                      class="menu-item-icon"
                      src="sprites/but_fullscreen.png"
                      alt="Fullscreen"
                      width="82"
                      height="82"
                    />
                  </div>
                  <div
                    class="menu-item"
                    id="menu-credits-right"
                    data-tooltip="How to"
                  >
                    <img
                      class="menu-item-icon"
                      src="sprites/but_ht.png"
                      alt="How to"
                      width="82"
                      height="82"
                    />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Fixed UI Area at Bottom of Game -->
      <div id="ui-container">
        <!-- Betting UI -->
        <div id="betting-ui" class="ui-panel" style="display: none">
          <div class="ui-content">
            <div class="bet-section">
              <div class="bet-label-container">
                <span class="bet-minmax">(1.0 - 5.0)</span>
                <label>BET:</label>
              </div>
              <div class="bet-controls">
                <button id="bet-minus" class="bet-btn">-</button>
                <div id="bet-display" class="bet-display">1.0 MON</div>
                <button id="bet-plus" class="bet-btn">+</button>
              </div>
            </div>
            <div class="difficulty-section">
              <label>MODE:</label>
              <div class="difficulty-controls">
                <button id="easy-mode" class="diff-btn active">EASY</button>
                <button id="hard-mode" class="diff-btn">HARD</button>
              </div>
            </div>
            <div class="play-mode-section">
              <label>PLAY:</label>
              <div class="play-mode-controls">
                <button id="manual-mode" class="mode-btn active">MANUAL</button>
                <button id="auto-mode" class="mode-btn">AUTO</button>
              </div>
            </div>
            <div class="action-buttons">
              <button
                id="recovery-funds"
                class="action-btn recovery"
                style="display: none"
              >
                🚨 RECOVER FUNDS
              </button>
              <button id="start-game" class="action-btn primary">
                START GAME
              </button>
              <button id="back-menu" class="action-btn secondary">HOME</button>
            </div>
          </div>
        </div>

        <!-- Game UI -->
        <div id="game-ui" class="ui-panel" style="display: none">
          <div class="ui-content">
            <div class="game-info">
              <div class="info-item">
                <span class="label">Bet:</span>
                <span id="game-bet">1.0 MON</span>
              </div>
              <div class="info-item">
                <span class="label">Mode:</span>
                <span id="game-mode">EASY</span>
              </div>
              <div class="info-item">
                <span class="label">Multiplier:</span>
                <span id="game-multiplier">1.3x</span>
              </div>
              <div class="info-item">
                <span class="label">Winnings:</span>
                <span id="game-winnings">1.3 MON</span>
              </div>
              <div class="info-item">
                <span class="label">Jumps:</span>
                <span id="game-jumps">0</span>
              </div>
            </div>
            <div class="game-actions">
              <button id="cashout-btn" class="action-btn danger cashout-button">
                CASHOUT
              </button>
              <button id="back-menu-game" class="action-btn secondary">
                HOME
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Auto Settings Panel -->
    <div
      id="auto-settings-panel"
      class="auto-settings-panel"
      style="display: none"
    >
      <div class="auto-settings-content">
        <div class="auto-settings-header">
          <h2>🤖 Auto Mode Settings</h2>
          <button id="close-auto-settings" class="close-btn">×</button>
        </div>
        <div class="auto-settings-body">
          <div class="target-platform-section">
            <label>Target Platform:</label>
            <div class="platform-controls">
              <button id="platform-minus" class="platform-btn">-</button>
              <div id="platform-display" class="platform-display">1</div>
              <button id="platform-plus" class="platform-btn">+</button>
            </div>
            <div class="platform-info">
              <span id="platform-multiplier">1.3x</span>
              <span id="platform-winnings">1.3 MON</span>
            </div>
          </div>
          <div class="auto-info-section">
            <div class="auto-info-item">
              <span class="info-label">Auto Jump:</span>
              <span class="info-value">Every 5 seconds</span>
            </div>
            <div class="auto-info-item">
              <span class="info-label">Auto Cashout:</span>
              <span class="info-value">At target platform</span>
            </div>
            <div class="auto-info-item">
              <span class="info-label">Auto Fail:</span>
              <span class="info-value">If missed target</span>
            </div>
          </div>
        </div>
        <div class="auto-settings-footer">
          <button id="confirm-auto-settings" class="action-btn primary">
            CONFIRM
          </button>
          <button id="cancel-auto-settings" class="action-btn secondary">
            CANCEL
          </button>
        </div>
      </div>
    </div>

    <!-- Options Panel -->
    <div id="options-panel" class="options-panel" style="display: none">
      <div class="options-content">
        <div class="options-header">
          <h2>⚙️ Game Options</h2>
          <button id="close-options" class="close-btn">×</button>
        </div>

        <div class="options-section">
          <h3>🔊 Audio Settings</h3>
          <div class="option-group">
            <label for="music-volume">Music Volume:</label>
            <input
              type="range"
              id="music-volume"
              min="0"
              max="100"
              value="20"
              class="volume-slider"
            />
            <span id="music-volume-value">20%</span>
          </div>
          <div class="option-group">
            <label for="sound-volume">Sound Effects:</label>
            <input
              type="range"
              id="sound-volume"
              min="0"
              max="100"
              value="100"
              class="volume-slider"
            />
            <span id="sound-volume-value">100%</span>
          </div>
        </div>

        <div class="options-section">
          <h3>🎨 Display Settings</h3>
          <div class="option-group">
            <label for="brightness">Brightness:</label>
            <input
              type="range"
              id="brightness"
              min="0"
              max="200"
              value="100"
              class="brightness-slider"
            />
            <span id="brightness-value">100%</span>
          </div>
          <div class="option-group">
            <label for="contrast">Contrast:</label>
            <input
              type="range"
              id="contrast"
              min="0"
              max="200"
              value="100"
              class="contrast-slider"
            />
            <span id="contrast-value">100%</span>
          </div>
          <div class="option-group">
            <label for="saturation">Saturation:</label>
            <input
              type="range"
              id="saturation"
              min="0"
              max="200"
              value="100"
              class="saturation-slider"
            />
            <span id="saturation-value">100%</span>
          </div>
          <div class="option-group">
            <label for="fullscreen-mode">Fullscreen Mode:</label>
            <select id="fullscreen-mode" class="fullscreen-select">
              <option value="windowed">Windowed</option>
              <option value="fullscreen">Fullscreen</option>
              <option value="borderless">Borderless Window</option>
            </select>
          </div>
        </div>

        <div class="options-actions">
          <button id="apply-options" class="apply-btn">Apply Changes</button>
          <button id="reset-options" class="reset-btn">Reset to Default</button>
        </div>
      </div>
    </div>

    <div data-orientation="portrait" class="orientation-msg-container">
      <p class="orientation-msg-text">Please rotate your device</p>
    </div>
    <div
      id="block_game"
      style="
        position: fixed;
        background-color: transparent;
        top: 0px;
        left: 0px;
        width: 100%;
        height: 100%;
        display: none;
      "
    ></div>

    <script src="js/SvgMenuSystem.js"></script>

    <!-- New Leaderboard System Scripts -->
    <script src="js/GhostGraphService.js"></script>
    <script src="js/LeaderboardManager.js"></script>
    <script src="js/CLeaderboardNew.js"></script>

    <!-- Small helper for the Connect/Open Wallet button in the left panel -->
    <script>
      (function () {
        const btn = document.getElementById("connect-wallet-game-btn");
        const updateText = () => {
          try {
            const auth =
              !!(window.privyWallet && window.privyWallet.authenticated) ||
              false;
            btn.textContent = auth ? "Open Wallet" : "Connect Wallet";
          } catch (e) {}
        };

        if (!btn) return;

        btn.addEventListener("click", async function () {
          try {
            // Try Privy global helper first
            if (window.privyWallet) {
              if (!window.privyWallet.authenticated) {
                // If a login helper exists on the page, call it
                if (typeof window.login === "function") {
                  try {
                    await window.login({ loginMethods: ["email", "wallet"] });
                    updateText();
                    return;
                  } catch (e) {}
                }
                // If Privy exposes a login modal helper
                if (typeof window.PrivyOpenLogin === "function") {
                  try {
                    window.PrivyOpenLogin();
                    return;
                  } catch (e) {}
                }
                alert("Please sign in using the Privy login");
                return;
              }

              // If authenticated, request accounts via provider
              try {
                const provider = await window.privyWallet.getEthereumProvider();
                if (provider && provider.request) {
                  await provider.request({ method: "eth_requestAccounts" });
                  updateText();
                  return;
                }
              } catch (e) {
                console.warn("Privy provider request failed:", e);
              }
            }

            // Try any exposed realPrivyProvider or injected provider
            const provider = window.realPrivyProvider || window.ethereum;
            if (provider && provider.request) {
              try {
                await provider.request({ method: "eth_requestAccounts" });
                updateText();
                return;
              } catch (err) {
                console.warn("eth_requestAccounts failed:", err);
              }
            }

            // Try walletManager API if present
            if (
              window.walletManager &&
              typeof window.walletManager.open === "function"
            ) {
              try {
                window.walletManager.open();
                return;
              } catch (e) {
                console.warn(e);
              }
            }

            alert(
              "No wallet provider found. Please install or enable an injected wallet (MetaMask/Rabby) or use the Privy login."
            );
          } catch (e) {
            console.error("Connect wallet button error:", e);
          }
        });

        // Update label when session events fire
        window.addEventListener("privySessionReady", updateText);
        window.addEventListener("walletConnected", updateText);
        setTimeout(updateText, 800);
      })();
    </script>
  </body>
</html>
